import sys

# vranks, nodes, deg
#
#
topologies = {
  (2,2,1) : '0;1',
  (2,2,2) : '0.1;1.0',
  (4,2,1) : '0;0;1;1',
  (4,2,2) : '0.1;0.1;1.0;1.0',
  (6,2,1) : '0;0;0;1;1;1',
  (6,2,2) : '0.1;0.1;0.1;1.0;1.0;1.0',
  (3,3,1) : '0;1;2',
  (3,3,2) : '0.1;1.2;2.0',
  (3,3,3) : '0.1.2;1.0.2;2.0.1',
  (6,3,1) : '0;0;1;1;2;2',
  (6,3,2) : '0.1;0.1;1.2;1.2;2.0;2.0',
  (6,3,3) : '0.1.2;0.1.2;1.0.2;1.0.2;2.0.1;2.0.1',
  (9,3,1) : '0;0;0;1;1;1;2;2;2',
  (9,3,2) : '0.1;0.2;0.2;1.2;1.0;1.0;2.0;2.1;2.1',
  (9,3,3) : '0.1.2;0.1.2;0.1.2;1.0.2;1.0.2;1.0.2;2.0.1;2.0.1;2.0.1',
  (4,4,1) : '0;1;2;3',
  (4,4,2) : '0.1;1.2;2.3;3.0',
  (4,4,3) : '0.1.3;1.0.2;2.1.3;3.0.2',
  (4,4,4) : '0.1.2.3;1.0.2.3;2.0.1.3;3.0.1.2',
  (8,4,1) : '0;0;1;1;2;2;3;3',
  (8,4,2) : '0.1;0.2;1.2;1.3;2.3;2.0;3.0;3.1',
  (8,4,3) : '0.1.2;0.1.3;1.2.3;1.0.2;2.0.3;2.1.3;3.0.1;3.0.2',
  (8,4,4) : '0.1.2.3;0.1.2.3;1.0.2.3;1.0.2.3;2.0.1.3;2.0.1.3;3.0.1.2;3.0.1.2',
  (8,8,1) : '0;1;2;3;4;5;6;7',
  (8,8,2) : '0.1;1.2;2.3;3.4;4.5;5.6;6.7;7.0',
  (8,8,3) : '0.1.3;1.2.6;2.3.7;3.0.4;4.1.5;5.2.6;6.4.7;7.0.5',
  (8,8,4) : '0.1.2.3;1.2.4.6;2.3.6.7;3.0.4.7;4.0.1.5;5.1.2.6;6.4.5.7;7.0.3.5',
  (8,8,5) : '0.1.2.3.6;1.2.4.5.6;2.0.3.6.7;3.0.2.4.7;4.0.1.5.7;5.1.2.4.6;6.3.4.5.7;7.0.1.3.5',
  (8,8,6) : '0.1.2.3.5.6;1.2.4.5.6.7;2.0.3.4.6.7;3.0.1.2.4.7;4.0.1.5.6.7;5.1.2.3.4.6;6.0.3.4.5.7;7.0.1.2.3.5',
  (8,8,7) : '0.1.2.3.4.5.6;1.0.2.4.5.6.7;2.0.1.3.4.6.7;3.0.1.2.4.5.7;4.0.1.3.5.6.7;5.1.2.3.4.6.7;6.0.2.3.4.5.7;7.0.1.2.3.5.6',
  (8,8,8) : '0.1.2.3.4.5.6.7;1.0.2.3.4.5.6.7;2.0.1.3.4.5.6.7;3.0.1.2.4.5.6.7;4.0.1.2.3.5.6.7;5.0.1.2.3.4.6.7;6.0.1.2.3.4.5.7;7.0.1.2.3.4.5.6',
  (12,4,1) : '0;0;0;1;1;1;2;2;2;3;3;3',
  (12,4,2) : '0.1;0.3;0.1;1.2;1.0;1.3;2.3;2.1;2.0;3.0;3.2;3.2',
  (12,4,3) : '0.1.2;0.1.3;0.1.2;1.2.3;1.0.2;1.0.3;2.0.3;2.1.3;2.0.3;3.0.1;3.0.2;3.1.2',
  (12,4,4) : '0.1.2.3;0.1.2.3;0.1.2.3;1.0.2.3;1.0.2.3;1.0.2.3;2.0.1.3;2.0.1.3;2.0.1.3;3.0.1.2;3.0.1.2;3.0.1.2',
  (5,5,1) : '0;1;2;3;4',
  (5,5,2) : '0.1;1.2;2.3;3.4;4.0',
  (5,5,3) : '0.1.4;1.0.2;2.1.3;3.2.4;4.0.3',
  (5,5,4) : '0.1.2.3;1.0.2.4;2.0.3.4;3.1.2.4;4.0.1.3',
  (5,5,5) : '0.1.2.3.4;1.0.2.3.4;2.0.1.3.4;3.0.1.2.4;4.0.1.2.3',
  (10,5,1) : '0;0;1;1;2;2;3;3;4;4',
  (10,5,2) : '0.1;0.2;1.2;1.3;2.3;2.4;3.4;3.0;4.0;4.1',
  (10,5,3) : '0.1.2;0.2.3;1.2.4;1.0.3;2.1.3;2.1.4;3.0.4;3.1.4;4.0.3;4.0.2',
  (10,5,4) : '0.1.2.3;0.1.3.4;1.0.2.4;1.0.2.3;2.1.3.4;2.0.3.4;3.0.2.4;3.1.2.4;4.0.1.3;4.0.1.2',
  (10,5,5) : '0.1.2.3.4;0.1.2.3.4;1.0.2.3.4;1.0.2.3.4;2.0.1.3.4;2.0.1.3.4;3.0.1.2.4;3.0.1.2.4;4.0.1.2.3;4.0.1.2.3',
  (15,5,1) : '0;0;0;1;1;1;2;2;2;3;3;3;4;4;4',
  (15,5,2) : '0.1;0.1;0.3;1.2;1.3;1.2;2.3;2.4;2.4;3.4;3.0;3.0;4.0;4.2;4.1',
  (15,5,3) : '0.1.4;0.1.4;0.3.4;1.2.3;1.0.2;1.0.2;2.0.3;2.0.3;2.3.4;3.2.4;3.1.4;3.1.2;4.0.1;4.2.3;4.0.1',
  (15,5,4) : '0.1.2.4;0.1.2.4;0.2.3.4;1.2.3.4;1.0.3.4;1.0.3.4;2.0.1.3;2.0.3.4;2.0.1.3;3.0.1.4;3.0.1.2;3.1.2.4;4.0.2.3;4.1.2.3;4.0.1.2',
  (15,5,5) : '0.1.2.3.4;0.1.2.3.4;0.1.2.3.4;1.0.2.3.4;1.0.2.3.4;1.0.2.3.4;2.0.1.3.4;2.0.1.3.4;2.0.1.3.4;3.0.1.2.4;3.0.1.2.4;3.0.1.2.4;4.0.1.2.3;4.0.1.2.3;4.0.1.2.3',
  (6,6,1) : '0;1;2;3;4;5',
  (6,6,2) : '0.1;1.2;2.3;3.4;4.5;5.0',
  (6,6,3) : '0.1.2;1.2.4;2.0.3;3.4.5;4.1.5;5.0.3',
  (6,6,4) : '0.1.3.4;1.0.2.3;2.1.3.5;3.0.4.5;4.1.2.5;5.0.2.4',
  (6,6,5) : '0.1.2.4.5;1.0.2.3.5;2.0.1.3.4;3.0.1.4.5;4.1.2.3.5;5.0.2.3.4',
  (6,6,6) : '0.1.2.3.4.5;1.0.2.3.4.5;2.0.1.3.4.5;3.0.1.2.4.5;4.0.1.2.3.5;5.0.1.2.3.4',
  (12,6,1) : '0;0;1;1;2;2;3;3;4;4;5;5',
  (12,6,2) : '0.1;0.2;1.2;1.3;2.3;2.5;3.4;3.0;4.5;4.1;5.0;5.4',
  (12,6,3) : '0.1.3;0.2.3;1.2.4;1.3.5;2.3.5;2.1.4;3.0.4;3.0.1;4.2.5;4.0.5;5.0.1;5.2.4',
  (12,6,4) : '0.1.3.4;0.1.3.4;1.2.3.5;1.2.4.5;2.3.4.5;2.1.3.5;3.0.1.4;3.0.4.5;4.0.2.5;4.0.1.2;5.0.1.2;5.0.2.3',
  (12,6,5) : '0.1.2.4.5;0.1.3.4.5;1.0.2.3.4;1.0.2.3.4;2.0.1.3.5;2.0.1.3.5;3.1.2.4.5;3.1.2.4.5;4.0.1.3.5;4.0.1.2.5;5.0.2.3.4;5.0.2.3.4',
  (12,6,6) : '0.1.2.3.4.5;0.1.2.3.4.5;1.0.2.3.4.5;1.0.2.3.4.5;2.0.1.3.4.5;2.0.1.3.4.5;3.0.1.2.4.5;3.0.1.2.4.5;4.0.1.2.3.5;4.0.1.2.3.5;5.0.1.2.3.4;5.0.1.2.3.4',
  (16,8,1) : '0;0;1;1;2;2;3;3;4;4;5;5;6;6;7;7',
  (16,8,2) : '0.1;0.3;1.2;1.4;2.3;2.5;3.4;3.6;4.5;4.7;5.6;5.0;6.7;6.1;7.0;7.2',
  (16,8,3) : '0.1.4;0.4.7;1.0.2;1.0.2;2.3.7;2.6.7;3.4.6;3.1.5;4.3.5;4.3.5;5.1.6;5.4.6;6.5.7;6.2.3;7.0.2;7.0.1',
  (16,8,4) : '0.1.2.3;0.2.4.6;1.0.2.6;1.0.4.5;2.1.3.4;2.1.5.6;3.4.5.7;3.0.4.7;4.3.5.6;4.1.6.7;5.2.6.7;5.2.3.7;6.0.5.7;6.2.3.5;7.0.1.4;7.0.1.3',
  (16,8,5) : '0.1.2.5.6;0.1.3.5.7;1.0.2.4.7;1.0.2.3.4;2.1.3.5.7;2.1.4.6.7;3.1.4.5.7;3.2.4.5.6;4.0.3.5.6;4.1.3.6.7;5.0.2.4.6;5.0.3.4.7;6.2.3.4.7;6.0.1.2.5;7.0.1.3.6;7.0.2.5.6',
  (16,8,6) : '0.1.3.4.5.6;0.2.3.4.5.7;1.0.2.3.6.7;1.0.2.3.5.7;2.0.1.3.6.7;2.1.3.4.6.7;3.0.1.2.4.5;3.0.1.2.5.6;4.0.1.2.5.7;4.0.1.5.6.7;5.1.3.4.6.7;5.0.3.4.6.7;6.2.3.4.5.7;6.0.1.2.4.5;7.0.2.4.5.6;7.1.2.3.4.6',
  (16,8,7) : '0.1.2.3.5.6.7;0.2.3.4.5.6.7;1.0.2.3.4.5.7;1.2.3.4.5.6.7;2.0.3.4.5.6.7;2.0.1.4.5.6.7;3.0.1.2.4.5.6;3.0.1.2.5.6.7;4.1.2.3.5.6.7;4.0.1.2.3.5.6;5.0.1.2.4.6.7;5.0.1.2.3.4.7;6.0.1.2.3.4.7;6.0.1.2.3.4.7;7.0.1.3.4.5.6;7.0.1.3.4.5.6',
  (16,8,8) : '0.1.2.3.4.5.6.7;0.1.2.3.4.5.6.7;1.0.2.3.4.5.6.7;1.0.2.3.4.5.6.7;2.0.1.3.4.5.6.7;2.0.1.3.4.5.6.7;3.0.1.2.4.5.6.7;3.0.1.2.4.5.6.7;4.0.1.2.3.5.6.7;4.0.1.2.3.5.6.7;5.0.1.2.3.4.6.7;5.0.1.2.3.4.6.7;6.0.1.2.3.4.5.7;6.0.1.2.3.4.5.7;7.0.1.2.3.4.5.6;7.0.1.2.3.4.5.6',
  (18,6,1) : '0;0;0;1;1;1;2;2;2;3;3;3;4;4;4;5;5;5',
  (18,6,2) : '0.1;0.2;0.2;1.2;1.3;1.4;2.3;2.5;2.1;3.4;3.0;3.5;4.5;4.1;4.3;5.0;5.4;5.0',
  (18,6,3) : '0.1.2;0.1.4;0.1.2;1.2.4;1.0.2;1.4.5;2.1.3;2.1.3;2.0.3;3.4.5;3.4.5;3.4.5;4.0.5;4.3.5;4.0.3;5.0.3;5.0.2;5.1.2',
  (18,6,4) : '0.1.2.3;0.1.2.3;0.2.3.4;1.2.4.5;1.0.4.5;1.2.3.4;2.0.1.3;2.3.4.5;2.0.1.5;3.2.4.5;3.0.1.2;3.1.2.5;4.0.3.5;4.2.3.5;4.0.3.5;5.0.1.4;5.0.1.4;5.0.1.4',
  (18,6,5) : '0.1.2.4.5;0.1.2.3.5;0.1.2.4.5;1.0.2.3.5;1.0.3.4.5;1.2.3.4.5;2.0.3.4.5;2.0.1.4.5;2.0.1.3.4;3.0.1.2.4;3.1.2.4.5;3.0.1.2.5;4.1.2.3.5;4.0.1.2.3;4.0.1.3.5;5.0.1.3.4;5.0.2.3.4;5.0.2.3.4',
  (18,6,6) : '0.1.2.3.4.5;0.1.2.3.4.5;0.1.2.3.4.5;1.0.2.3.4.5;1.0.2.3.4.5;1.0.2.3.4.5;2.0.1.3.4.5;2.0.1.3.4.5;2.0.1.3.4.5;3.0.1.2.4.5;3.0.1.2.4.5;3.0.1.2.4.5;4.0.1.2.3.5;4.0.1.2.3.5;4.0.1.2.3.5;5.0.1.2.3.4;5.0.1.2.3.4;5.0.1.2.3.4',
  (7,7,1) : '0;1;2;3;4;5;6',
  (7,7,2) : '0.1;1.2;2.3;3.4;4.5;5.6;6.0',
  (7,7,3) : '0.1.2;1.2.6;2.3.4;3.4.5;4.0.5;5.1.6;6.0.3',
  (7,7,4) : '0.1.3.4;1.0.2.6;2.1.3.5;3.1.2.4;4.0.5.6;5.3.4.6;6.0.2.5',
  (7,7,5) : '0.1.2.5.6;1.0.2.3.6;2.1.3.4.5;3.0.1.4.6;4.0.1.2.5;5.2.3.4.6;6.0.3.4.5',
  (7,7,6) : '0.1.2.3.4.5;1.2.3.4.5.6;2.0.3.4.5.6;3.0.1.4.5.6;4.0.1.2.5.6;5.0.1.2.3.6;6.0.1.2.3.4',
  (7,7,7) : '0.1.2.3.4.5.6;1.0.2.3.4.5.6;2.0.1.3.4.5.6;3.0.1.2.4.5.6;4.0.1.2.3.5.6;5.0.1.2.3.4.6;6.0.1.2.3.4.5',
  (14,7,1) : '0;0;1;1;2;2;3;3;4;4;5;5;6;6',
  (14,7,2) : '0.1;0.2;1.2;1.5;2.3;2.6;3.4;3.0;4.5;4.1;5.6;5.3;6.0;6.4',
  (14,7,3) : '0.1.3;0.1.4;1.2.4;1.0.2;2.0.3;2.4.6;3.4.6;3.1.6;4.2.5;4.3.5;5.1.6;5.0.2;6.0.5;6.3.5',
  (14,7,4) : '0.1.4.5;0.2.4.5;1.0.2.3;1.0.3.5;2.1.3.5;2.1.4.6;3.2.4.6;3.2.5.6;4.2.5.6;4.0.1.3;5.0.1.6;5.3.4.6;6.0.3.4;6.0.1.2',
  (14,7,5) : '0.1.3.4.6;0.1.2.4.5;1.0.2.3.5;1.0.2.4.6;2.1.3.4.6;2.0.3.5.6;3.0.2.4.5;3.1.2.4.6;4.0.2.5.6;4.0.3.5.6;5.1.3.4.6;5.0.1.2.3;6.0.1.2.5;6.1.3.4.5',
  (14,7,6) : '0.1.2.3.5.6;0.1.3.4.5.6;1.0.2.3.4.6;1.2.3.4.5.6;2.1.3.4.5.6;2.0.3.4.5.6;3.0.1.2.4.5;3.0.1.2.5.6;4.0.1.2.5.6;4.0.1.2.3.5;5.0.2.3.4.6;5.0.1.2.4.6;6.0.1.3.4.5;6.0.1.2.3.4',
  (14,7,7) : '0.1.2.3.4.5.6;0.1.2.3.4.5.6;1.0.2.3.4.5.6;1.0.2.3.4.5.6;2.0.1.3.4.5.6;2.0.1.3.4.5.6;3.0.1.2.4.5.6;3.0.1.2.4.5.6;4.0.1.2.3.5.6;4.0.1.2.3.5.6;5.0.1.2.3.4.6;5.0.1.2.3.4.6;6.0.1.2.3.4.5;6.0.1.2.3.4.5',
  (21,7,1) : '0;0;0;1;1;1;2;2;2;3;3;3;4;4;4;5;5;5;6;6;6',
  (21,7,2) : '0.1;0.2;0.4;1.2;1.3;1.5;2.3;2.4;2.6;3.4;3.5;3.0;4.5;4.6;4.1;5.6;5.0;5.2;6.0;6.1;6.3',
  (21,7,3) : '0.1.4;0.3.4;0.2.3;1.0.2;1.2.4;1.5.6;2.3.6;2.0.5;2.0.5;3.4.5;3.0.1;3.1.4;4.1.5;4.5.6;4.0.6;5.3.6;5.2.6;5.1.4;6.0.2;6.1.3;6.2.3',
  (21,7,4) : '0.1.3.5;0.4.5.6;0.2.4.6;1.0.2.4;1.0.3.5;1.0.2.3;2.1.3.6;2.0.3.4;2.4.5.6;3.1.4.6;3.1.2.5;3.1.4.6;4.2.3.5;4.1.2.6;4.1.3.5;5.0.4.6;5.0.3.6;5.0.1.3;6.0.2.5;6.1.2.4;6.0.2.5',
  (21,7,5) : '0.1.3.4.6;0.1.2.4.5;0.1.2.4.5;1.0.2.5.6;1.0.2.3.6;1.2.3.5.6;2.0.1.3.4;2.1.3.4.6;2.0.3.4.6;3.2.4.5.6;3.0.4.5.6;3.0.1.2.5;4.0.1.3.5;4.1.3.5.6;4.0.1.3.6;5.1.2.4.6;5.0.1.2.4;5.1.3.4.6;6.0.2.3.5;6.0.2.3.5;6.0.2.4.5'
};

def unpack_desc(desc):
	return [ [int(s) for s in group.split('.')] for group in desc.split(';')]
# 
# def pack_desc(s):
# 	return ';'.join([ ','.join([str(n) for n in g]) for g in s])
# 
# def get_split(nodes, deg):
# 	s = splits.get((nodes,deg))
# 	if s is None:
# 		print 'Cannot get split(', nodes, ',', deg, ')'
# 	return s

def get_topology(nodes, deg, vranks):

	# Convert from old format
	#keys = [(b,a,c) for (a,b,c) in topologies.keys()]
	#keys.sort()
	#print(keys)
	#for (b,a,c) in keys:
	#	old_desc = topologies[(a,b,c)]
	#	splitted = [ [int(s) for s in group.split(',')] for group in old_desc.split(';')]
	#	new_desc = ';'.join([ '.'.join([str(n) for n in g]) for g in splitted])
	#	print('  (%d,%d,%d) : \'%s\',' % (a,b,c, new_desc))
	#sys.exit(0)

	if vranks == 1:
		if deg != nodes:
			return None
		else:
			topology = '.'.join([str(n) for n in range(0,nodes)])

	topology = topologies[ (vranks, nodes, deg) ]
	t = unpack_desc(topology)
	assert len(t) == vranks
	for j in t:
		assert len(j) == deg
	minval = min([min(j) for j in t])
	maxval = max([max(j) for j in t])
	assert minval == 0
	assert maxval == nodes-1

	return topology
